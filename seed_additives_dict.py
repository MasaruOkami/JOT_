#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
additives_dict マスターデータ ワンコード同期スクリプト

- ALL_ADDITIVES に辞書として定義した全添加物エントリを詰め込む
- name_ja で upsert するので、何回実行しても OK（マスターデータ同期）
"""

import os
import re
from typing import Any, Dict, List

from supabase import create_client, Client

# ==========
# Supabase 設定
# ==========

SUPABASE_URL = os.environ.get("SUPABASE_URL")
SUPABASE_SERVICE_ROLE_KEY = os.environ.get("SUPABASE_SERVICE_ROLE_KEY")

if not SUPABASE_URL or not SUPABASE_SERVICE_ROLE_KEY:
    raise RuntimeError("SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY を環境変数で指定してください。")

supabase: Client = create_client(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY)


# ==========
# 正規化ヘルパー
# ==========

def normalize_text(s: str | None) -> str | None:
    """name_ja_normalized / alias_normalized 用：空白削除＋小文字"""
    if not s:
        return None
    s = re.sub(r"\s+", "", s)
    return s.lower()


def build_alias_normalized(
    aliases: List[str] | None,
    label_names: List[str] | None
) -> List[str]:
    """aliases + label_names ⇒ alias_normalized（重複除去）"""
    aliases = aliases or []
    label_names = label_names or []
    seen = set()
    result: List[str] = []
    for raw in aliases + label_names:
        norm = normalize_text(raw)
        if norm and norm not in seen:
            seen.add(norm)
            result.append(norm)
    return result


def prepare_additive_row(raw: Dict[str, Any]) -> Dict[str, Any]:
    """
    各エントリ dict を additives_dict 用に整形する
    - name_ja_normalized / alias_normalized を自動計算
    - is_active / tags / フラグなどのデフォルトを補完
    """
    row = raw.copy()

    row.setdefault("aliases", [])
    row.setdefault("label_names", [])
    row.setdefault("tags", [])
    row.setdefault("is_active", True)
    row.setdefault("risk_score", None)

    # 正規化カラム
    row["name_ja_normalized"] = normalize_text(row.get("name_ja"))
    row["alias_normalized"] = build_alias_normalized(
        row.get("aliases"), row.get("label_names")
    )

    # 評価機関フラグ系（今は未使用なら全部 False でOK）
    row.setdefault("has_jecfa", False)
    row.setdefault("has_efsa", False)
    row.setdefault("has_fda", False)
    row.setdefault("has_mhlw_eval", False)

    return row


# ==========
# ここから「全部入り辞書」ゾーン
# ==========

ALL_ADDITIVES: List[Dict[str, Any]] = [

    # =========================================================
    # 甘味料（10件くらい）
    # =========================================================

    # アスパルテーム
    {
        "code": "E951",
        "name_ja": "アスパルテーム",
        "name_en": "Aspartame",
        "category": "甘味料",
        "aliases": [
            "L-フェニルアラニン化合物",
            "L-フェニルアラニン化L-アスパラギン酸メチル",
            "アスパルテーム・L-フェニルアラニン化合物",
            "人工甘味料アスパルテーム",
        ],
        "label_names": [
            "甘味料（アスパルテーム・L-フェニルアラニン化合物）",
            "甘味料（アスパルテーム）",
        ],
        "function_detail": "低カロリーで砂糖に近い甘味を与える高甘味度甘味料。",
        "typical_foods": "ダイエット飲料、ゼロカロリー飲料、ガム、キャンディ、デザートなど。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "risk_score": 2.2,
        "simple_summary": "低カロリー飲料や菓子類に広く使われる人工甘味料。通常の摂取量での安全性は評価されているが、フェニルケトン尿症の人は注意が必要とされる。",
        "detail_safety": "各国でADIが設定されており通常量では安全とされるが、フェニルケトン尿症では摂取制限が推奨される。",
        "detail_effect": "砂糖の数百倍の甘さで、カロリーオフ製品の甘味設計に用いられる。",
        "detail_risks": "人工甘味料飲料の多用が飲料依存や甘味嗜好の習慣につながる懸念がある。",
        "vulnerable_groups": "フェニルケトン尿症の人、人工甘味料に敏感な人。",
        "usage_guideline": "ゼロ飲料ばかりに偏らず、水やお茶とバランスを取るのが望ましい。",
        "shopping_advice": "成分表示の『甘味料（アスパルテーム・L-フェニルアラニン化合物）』が目印。",
        "cooking_tips": "家庭では香りや酸味を活かし、砂糖量を控えめにする工夫が有効。",
        "evidence_level": 3,
        "tags": ["甘味料", "人工甘味料", "ゼロカロリー"],
        "note_for_reply": "通常量なら安全とされますが、ゼロ飲料に頼りきりにならないバランスをおすすめする言い回しが使えます。",
    },

    # アセスルファムカリウム
    {
        "code": "E950",
        "name_ja": "アセスルファムカリウム",
        "name_en": "Acesulfame K",
        "category": "甘味料",
        "aliases": [
            "アセスルファムK",
            "アセスルファムカリウム（アセスルファムK）",
            "人工甘味料アセスルファムK",
        ],
        "label_names": [
            "甘味料（アセスルファムK）",
            "甘味料（アセスルファムカリウム）",
        ],
        "function_detail": "砂糖の数百倍の甘さを持つ高甘味度甘味料。他の甘味料とブレンドされることが多い。",
        "typical_foods": "ゼロカロリー飲料、ガム、デザート類、菓子パンなど。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "砂糖の数百倍の甘さを持つ人工甘味料。単独または他の甘味料と併用され、飲料やデザートのカロリーオフに用いられる。",
        "detail_safety": "ADI が設定され通常の使用範囲では安全とされるが、甘味料全体の摂取バランスには注意が推奨される。",
        "detail_effect": "砂糖の代わりに強い甘味を付与し、カロリーオフ・糖質オフ製品の甘味設計に使われる。",
        "typical_foods": "ゼロカロリー飲料、ガム、デザート類、菓子パンなど。",
        "tags": ["甘味料", "人工甘味料"],
    },

    # スクラロース
    {
        "code": "E955",
        "name_ja": "スクラロース",
        "name_en": "Sucralose",
        "category": "甘味料",
        "aliases": [
            "人工甘味料スクラロース",
            "トリクロロスクロース",
        ],
        "label_names": [
            "甘味料（スクラロース）",
        ],
        "function_detail": "砂糖由来の高甘味度甘味料で加熱や酸に強い。",
        "typical_foods": "清涼飲料、デザート、菓子類、加工食品全般。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "砂糖由来の高甘味度甘味料で、加熱や酸に強く味の安定性が高い。多くのカロリーオフ製品で使用されている。",
        "detail_safety": "動物実験などに基づきADIが設定されており、通常の摂取量では安全と評価されているが、腸内環境への影響を懸念する議論もある。",
        "detail_effect": "砂糖の数百倍の甘味を持ち、カロリーオフ製品や長期保存が必要な食品の甘味付けに用いられる。",
        "tags": ["甘味料", "人工甘味料"],
    },

    # サッカリンナトリウム
    {
        "code": "E954",
        "name_ja": "サッカリンナトリウム",
        "name_en": "Saccharin sodium",
        "category": "甘味料",
        "aliases": [
            "サッカリンNa",
            "サッカリン",
            "サッカリンナトリウム水和物",
        ],
        "label_names": [
            "甘味料（サッカリンNa）",
            "甘味料（サッカリンナトリウム）",
        ],
        "function_detail": "古くから使われている高甘味度甘味料。独特の後味を持つ。",
        "typical_foods": "漬物、缶詰、特定の菓子類、低カロリー食品など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "古くから使われる高甘味度甘味料。使用量は規制され通常の摂取量では安全と評価されるが、味やイメージから敬遠されることもある。",
        "detail_safety": "過去に発がん性の議論があったが、現在は使用量を制限したうえで許可されている。",
        "detail_effect": "砂糖の代替として、低カロリー食品や特定の加工品で使用される。",
        "tags": ["甘味料", "人工甘味料"],
    },

    # ステビア
    {
        "code": None,
        "name_ja": "ステビア",
        "name_en": "Stevia (Steviol glycosides)",
        "category": "甘味料",
        "aliases": [
            "ステビア抽出物",
            "ステビオール配糖体",
            "ステビア甘味料",
        ],
        "label_names": [
            "甘味料（ステビア）",
            "甘味料（ステビア抽出物）",
            "甘味料（ステビオール配糖体）",
        ],
        "function_detail": "植物由来の高甘味度甘味料。後味に特徴がある。",
        "typical_foods": "清涼飲料、ヨーグルト、健康志向の菓子類など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "植物由来の高甘味度甘味料。甘味が強く後味に特徴があるため、他の甘味料と併用されることが多い。",
        "detail_safety": "各国の評価機関でADIが設定され、通常の使用範囲では安全とされているが、独特の後味が気になる人もいる。",
        "detail_effect": "砂糖の代替として、カロリーオフ飲料や健康志向商品で使用される。",
        "tags": ["甘味料", "天然由来"],
    },

    # アドバンテーム
    {
        "code": None,
        "name_ja": "アドバンテーム",
        "name_en": "Advantame",
        "category": "甘味料",
        "aliases": [
            "アドバンテーム（高甘味度甘味料）",
        ],
        "label_names": [
            "甘味料（アドバンテーム）",
        ],
        "function_detail": "非常に高い甘味度を持つ新しいタイプの高甘味度甘味料。",
        "typical_foods": "ゼロカロリー飲料、特定保健用食品、低カロリー菓子など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "非常に高い甘味度を持つ新しいタイプの甘味料。ごく少量で強い甘さを付与できる。",
        "detail_safety": "各国で評価が進み、設定された使用基準の範囲内では安全とされるが、長期的な利用動向は今後も注視される。",
        "detail_effect": "他の甘味料と併用され、味やコストを調整する目的で使われることが多い。",
    },

    # ネオテーム
    {
        "code": None,
        "name_ja": "ネオテーム",
        "name_en": "Neotame",
        "category": "甘味料",
        "aliases": [
            "新世代高甘味度甘味料ネオテーム",
        ],
        "label_names": [
            "甘味料（ネオテーム）",
        ],
        "function_detail": "アスパルテームを改良した構造を持つ高甘味度甘味料。",
        "typical_foods": "ゼロカロリー飲料、低カロリー菓子、加工食品など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "アスパルテームを改良した構造を持つ高甘味度甘味料で、ごく少量で非常に強い甘味を付与できる。",
        "detail_safety": "国際機関でADIが設定され、通常の使用量では安全とされるが、高甘味度甘味料の多用には注意する意見もある。",
        "detail_effect": "カロリーオフ・糖質オフ製品で他の甘味料と組み合わせて味やコストを調整するために利用される。",
    },

    # エリスリトール（糖アルコール）
    {
        "code": None,
        "name_ja": "エリスリトール",
        "name_en": "Erythritol",
        "category": "甘味料",
        "aliases": [
            "糖アルコール（エリスリトール）",
        ],
        "label_names": [
            "甘味料（エリスリトール）",
        ],
        "function_detail": "カロリーがほぼゼロの糖アルコール系甘味料。血糖値への影響が少ない。",
        "typical_foods": "糖質オフ菓子、飲料、デザート、甘味料ミックスなど。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "血糖値への影響が少ない糖アルコール系甘味料。カロリーオフや糖質オフ商品でよく使われる。",
        "detail_safety": "一般に安全性は高いとされるが、大量摂取でお腹がゆるくなる可能性がある。",
        "detail_effect": "砂糖の甘さの約7割程度の甘味を持ち、後味が比較的すっきりしている。",
        "vulnerable_groups": "お腹がゆるくなりやすい人、小児では一度に大量摂取しない方が安心。",
    },

    # キシリトール
    {
        "code": None,
        "name_ja": "キシリトール",
        "name_en": "Xylitol",
        "category": "甘味料",
        "aliases": [
            "糖アルコール（キシリトール）",
        ],
        "label_names": [
            "甘味料（キシリトール）",
        ],
        "function_detail": "砂糖とほぼ同程度の甘さを持つ糖アルコール系甘味料。虫歯リスクを下げる働きが知られる。",
        "typical_foods": "ガム、タブレット菓子、オーラルケア系のお菓子など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "虫歯リスクを下げる効果が期待される糖アルコール系甘味料。ガムなどで広く利用されている。",
        "detail_safety": "人では通常量の摂取で安全とされるが、大量に摂るとお腹がゆるくなることがある。",
        "detail_effect": "虫歯菌が利用しづらい甘味料として、歯科領域でも利用されている。",
    },

    # ソルビトール（甘味料＆保湿剤）
    {
        "code": None,
        "name_ja": "ソルビトール",
        "name_en": "Sorbitol",
        "category": "甘味料",
        "aliases": [
            "ソルビット",
            "糖アルコール（ソルビトール）",
        ],
        "label_names": [
            "甘味料（ソルビトール）",
            "甘味料（ソルビット）",
        ],
        "function_detail": "砂糖の半分程度の甘さを持つ糖アルコール。保湿剤としても使用される。",
        "typical_foods": "ガム、キャンディ、ゼリー、低カロリー菓子、加工食品全般。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "甘味料兼保湿剤として使われる糖アルコール。摂り過ぎるとお腹がゆるくなることがある。",
        "detail_safety": "通常量では安全とされるが、大量摂取で下痢や腹部膨満感の原因となる場合がある。",
        "detail_effect": "食品のしっとり感を保ちつつ、砂糖よりカロリーを抑えられる。",
    },

    # =========================================================
    # 保存料（安息香酸系 / ソルビン酸系）
    # =========================================================

    # 安息香酸
    {
        "code": "E210",
        "name_ja": "安息香酸",
        "name_en": "Benzoic Acid",
        "category": "保存料",
        "aliases": ["ベンゾ酸", "保存料（安息香酸）"],
        "label_names": ["保存料（安息香酸）"],
        "function_detail": "微生物の増殖を抑制する保存料。",
        "typical_foods": "清涼飲料、ドレッシング、漬物、ソースなど。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "微生物の増殖を抑える保存料。ビタミンCとの反応でベンゼン生成の可能性が指摘され注意が必要。",
        "detail_safety": "ADI 内での使用は認められるが、飲料とビタミンCの併用条件によってベンゼン生成が起こり得るとの報告がある。",
        "detail_effect": "酸性の食品中で細菌やカビの増殖を抑え、賞味期限を延ばす目的で使用される。",
        "detail_risks": "清涼飲料を大量に飲む習慣があると、安息香酸系添加物の摂取量が相対的に増える。",
        "vulnerable_groups": "清涼飲料を頻繁に飲む人、添加物に敏感な人。",
    },

    # 安息香酸ナトリウム
    {
        "code": "E211",
        "name_ja": "安息香酸ナトリウム",
        "name_en": "Sodium Benzoate",
        "category": "保存料",
        "aliases": ["安息香酸Na", "保存料（安息香酸Na）"],
        "label_names": [
            "保存料（安息香酸Na）",
            "保存料（安息香酸ナトリウム）",
        ],
        "function_detail": "安息香酸のナトリウム塩で、水に溶けやすく保存料として広く利用される。",
        "typical_foods": "清涼飲料、ソース、加工食品、調味料など。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "保存料として広く使われるが、ビタミンCとの反応や体質による影響の議論から注意添加物として扱われる。",
        "detail_safety": "使用基準内では認められているが、飲料などでの併用条件に注意が必要。",
        "detail_effect": "酸性の食品環境で保存性を高めるために使われる。",
    },

    # 総称：保存料（安息香酸系）
    {
        "code": None,
        "name_ja": "保存料（安息香酸系）",
        "name_en": "Preservatives (Benzoates)",
        "category": "保存料",
        "aliases": ["保存料（安息香酸）", "保存料（安息香酸Na）"],
        "label_names": ["保存料（安息香酸系）"],
        "function_detail": "安息香酸およびその塩類の総称。",
        "typical_foods": "清涼飲料、漬物、ソース、加工食品全般。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "安息香酸系保存料の総称。食品保存の目的で使用されるが、特定条件下での生成物が議論される。",
        "detail_safety": "食品を腐敗から守る目的で使用されるが、飲料や酸性食品との組み合わせに注意が必要。",
    },

    # ソルビン酸
    {
        "code": "E200",
        "name_ja": "ソルビン酸",
        "name_en": "Sorbic Acid",
        "category": "保存料",
        "aliases": ["保存料（ソルビン酸）"],
        "label_names": ["保存料（ソルビン酸）"],
        "function_detail": "防カビ効果を持ち、食品の保存性を高める。",
        "typical_foods": "漬物、菓子、ジュース、練り製品など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "防カビ効果を持ち、食品の保存性を高めるために広く使用される保存料。",
        "detail_safety": "通常の範囲での使用は安全とされるが、体質によっては刺激感や過敏症の報告もある。",
        "detail_effect": "カビや酵母の増殖を抑える目的で使用される。",
    },

    # ソルビン酸カリウム
    {
        "code": "E202",
        "name_ja": "ソルビン酸カリウム",
        "name_en": "Potassium Sorbate",
        "category": "保存料",
        "aliases": ["ソルビン酸K", "保存料（ソルビン酸K）"],
        "label_names": ["保存料（ソルビン酸K）", "保存料（ソルビン酸カリウム）"],
        "function_detail": "ソルビン酸のカリウム塩で、防カビ効果が高く最も広く使われる。",
        "typical_foods": "菓子、パン、漬物、飲料、加工食品全般。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "ソルビン酸のカリウム塩で、保存料として最も広く使われる。微生物抑制効果が高い。",
        "detail_safety": "ADI 内で安全とされるが、過敏症や体質差が報告されるため過剰摂取には注意。",
        "detail_effect": "カビ・酵母・細菌の増殖を抑えて食品の保存性を高める。",
    },

    # 総称：保存料（ソルビン酸系）
    {
        "code": None,
        "name_ja": "保存料（ソルビン酸系）",
        "name_en": "Preservatives (Sorbates)",
        "category": "保存料",
        "aliases": ["保存料（ソルビン酸）", "保存料（ソルビン酸K）"],
        "label_names": ["保存料（ソルビン酸系）"],
        "function_detail": "ソルビン酸およびその塩類の総称で、強い防カビ効果を持つ。",
        "typical_foods": "漬物、菓子、ジュース、加工食品全般。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "ソルビン酸・ソルビン酸塩類の総称で強い防カビ効果を持つ。",
        "detail_safety": "保存性向上の目的で使用されるが、体質差による刺激感などの報告がある。",
        "detail_effect": "微生物の増殖を抑えることで食品の賞味期限を延ばす。",
    },

    # =========================================================
    # 酸化防止剤（BHT / BHA / 総称）
    # =========================================================

    # BHT
    {
        "code": "E321",
        "name_ja": "BHT",
        "name_en": "Butylated hydroxytoluene",
        "category": "酸化防止剤",
        "aliases": [
            "ジブチルヒドロキシトルエン",
            "ジ tert-ブチル-p-クレゾール",
            "酸化防止剤BHT",
        ],
        "label_names": [
            "酸化防止剤（BHT）",
            "酸化防止剤（ジブチルヒドロキシトルエン）",
        ],
        "function_detail": "油脂の酸化を防ぐために用いられる合成酸化防止剤。",
        "typical_foods": "スナック菓子、マーガリン、即席麺、ナッツ類など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "油脂の酸化を防ぐために使われる合成酸化防止剤。規定量内の使用は認められているが、長期的影響を懸念して控えたいと考える人も多い。",
        "detail_safety": "ADI 内での使用は認められているが、高用量の動物実験結果などから『できれば摂取を抑えたい添加物』として扱われることもある。",
        "detail_effect": "油脂の風味劣化や変敗を防ぎ、商品寿命を延ばす。",
    },

    # BHA
    {
        "code": "E320",
        "name_ja": "ブチルヒドロキシアニソール",
        "name_en": "Butylated hydroxyanisole",
        "category": "酸化防止剤",
        "aliases": [
            "BHA",
            "ブチルヒドロキシアニソール（BHA）",
            "酸化防止剤BHA",
        ],
        "label_names": [
            "酸化防止剤（BHA）",
            "酸化防止剤（ブチルヒドロキシアニソール）",
        ],
        "function_detail": "油脂や香料の酸化を防ぐための合成酸化防止剤。",
        "typical_foods": "油脂を含むスナック菓子、冷凍食品、ガム、香料入り加工食品など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "油脂や香料の酸化を防ぐために用いられる合成酸化防止剤。使用基準内での利用は認められているが、動物実験の知見などから注意したい添加物として挙げられることも多い。",
        "detail_safety": "法令で使用量や対象食品が定められており、その範囲内で利用される。",
        "detail_effect": "油脂の酸化や香料の劣化を抑え、風味と品質を保つ。",
    },

    # 総称：酸化防止剤
    {
        "code": None,
        "name_ja": "酸化防止剤",
        "name_en": "Antioxidants (general)",
        "category": "酸化防止剤",
        "aliases": [
            "酸化防止剤（V.E）",
            "酸化防止剤（ビタミンE）",
            "酸化防止剤（ローズマリー抽出物）",
            "酸化防止剤（BHT）",
            "酸化防止剤（BHA）",
        ],
        "label_names": [
            "酸化防止剤",
            "酸化防止剤（ビタミンE）",
            "酸化防止剤（ローズマリー抽出物）",
        ],
        "function_detail": "油脂の酸化や変敗を防ぐ目的で使われる添加物の総称。",
        "typical_foods": "スナック菓子、揚げ物、マーガリン、ドレッシング、ナッツなど油脂を含む食品全般。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "油脂の酸化や変敗を防ぐ目的で使われる添加物の総称。ビタミンEなど穏やかなものからBHA/BHTなど合成品まで含まれる。",
        "detail_safety": "個々の物質ごとに安全性評価と使用基準が定められており、天然由来・合成由来など性質もさまざま。",
        "detail_effect": "油脂の酸化を抑え、風味や栄養価の低下を防ぐ。",
    },

    # =========================================================
    # 発色剤（亜硝酸塩系）
    # =========================================================

    # 亜硝酸ナトリウム
    {
        "code": "E250",
        "name_ja": "亜硝酸ナトリウム",
        "name_en": "Sodium Nitrite",
        "category": "発色剤",
        "aliases": ["亜硝酸Na", "発色剤（亜硝酸Na）"],
        "label_names": ["発色剤（亜硝酸Na）", "発色剤（亜硝酸ナトリウム）"],
        "function_detail": "肉製品の色調と風味を安定させる発色剤。",
        "typical_foods": "ハム、ソーセージ、ベーコン、サラミなどの加工肉。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "肉製品の色と風味を保つための発色剤。高温加熱や摂り過ぎによりニトロソアミン生成リスクが指摘される。",
        "detail_safety": "ADI 基準内の使用は認められているが、加工肉の多量摂取が健康リスクと関連するとの報告がある。",
        "detail_effect": "肉の赤色を安定させ、保存性と風味の維持に寄与する。",
    },

    # 亜硝酸カリウム
    {
        "code": "E249",
        "name_ja": "亜硝酸カリウム",
        "name_en": "Potassium Nitrite",
        "category": "発色剤",
        "aliases": ["亜硝酸K", "発色剤（亜硝酸K）"],
        "label_names": ["発色剤（亜硝酸K）", "発色剤（亜硝酸カリウム）"],
        "function_detail": "肉製品の色調を安定させる発色剤。",
        "typical_foods": "ハム、ソーセージ、ベーコン、加工肉全般。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "肉製品の色調を安定させる発色剤で、過剰摂取や加熱条件でニトロソアミン生成リスクが指摘される。",
        "detail_safety": "亜硝酸塩と同様にADI基準内の使用は許可されているが、長期・多量摂取には注意が必要とされる。",
        "detail_effect": "肉製品の色を固定し、保存性を改善する目的で使用される。",
    },

    # 総称：発色剤（亜硝酸塩系）
    {
        "code": None,
        "name_ja": "発色剤（亜硝酸塩系）",
        "name_en": "Colour fixatives (Nitrites)",
        "category": "発色剤",
        "aliases": ["発色剤（亜硝酸Na）", "発色剤（亜硝酸K）"],
        "label_names": ["発色剤（亜硝酸塩）", "発色剤（亜硝酸塩類）"],
        "function_detail": "亜硝酸ナトリウム・亜硝酸カリウムなど、加工肉の色を保つ目的で使われる発色剤の総称。",
        "typical_foods": "ハム、ソーセージ、ベーコンなどの加工肉全般。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "加工肉の色と風味を保つために使われる発色剤（亜硝酸塩）の総称。多量摂取や高温調理との組み合わせに注意が必要。",
        "detail_safety": "国際機関がADIを設定しているが、加工肉の常習的多量摂取は心血管疾患やがんリスクの上昇と関連する報告がある。",
        "detail_effect": "見た目と風味を向上させる一方で、バランスの取れた食べ方が求められる添加物群。",
    },
]
    # =========================================================
    # pH調整剤
    # =========================================================

    # 総称：pH調整剤
    {
        "code": None,
        "name_ja": "pH調整剤",
        "name_en": "Acidity regulators (general)",
        "category": "pH調整剤",
        "aliases": [
            "酸度調整剤",
            "pH 調整剤",
        ],
        "label_names": [
            "pH調整剤",
            "酸度調整剤",
        ],
        "function_detail": "食品の酸味やpHを調整し、味のバランスや保存性を整えるために使われる添加物の総称。",
        "typical_foods": "清涼飲料、ドレッシング、漬物、加工肉、菓子パンなど幅広い加工食品。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "酸味やpHを調整して味や保存性を整えるために使われる総称。クエン酸や乳酸、リン酸塩などさまざまな種類がある。",
        "detail_safety": "一般的な使用範囲では安全性が評価されているが、リン酸塩など特定成分は摂り過ぎに注意が必要とされることもある。",
        "detail_effect": "味の尖りを和らげたり、酸味を強めたり、微生物の増殖しにくい環境に整えるなどの役割を持つ。",
        "detail_risks": "加工食品に偏った食生活では、リン酸塩やナトリウム量などが過剰になりがちな点に注意。",
        "vulnerable_groups": "腎機能に不安のある人や塩分制限中の人は、加工食品全般の摂り過ぎに注意が望ましい。",
        "usage_guideline": "単体の危険性というより、加工食品全体の量とのバランスを見る意識が大切。",
        "shopping_advice": "成分表示の『pH調整剤』『酸度調整剤』が目印。毎日大量に摂る食品はなるべくシンプルな原材料のものも選びたい。",
        "cooking_tips": "家庭ではレモン汁や酢、ヨーグルトなど自然な酸味素材を活用すると、pH調整剤に頼らず味のバランスを整えやすい。",
        "evidence_level": 3,
        "tags": ["pH調整剤", "酸度調整剤"],
        "note_for_reply": "『加工食品全体のバランス』に言及しつつ、必要以上に不安をあおらないトーンがおすすめです。",
    },

    # クエン酸
    {
        "code": "E330",
        "name_ja": "クエン酸",
        "name_en": "Citric Acid",
        "category": "pH調整剤",
        "aliases": [
            "酸味料（クエン酸）",
            "pH調整剤（クエン酸）",
        ],
        "label_names": [
            "酸味料（クエン酸）",
            "pH調整剤（クエン酸）",
        ],
        "function_detail": "レモンなどに含まれる有機酸で、酸味付けとpH調整の両方に使われる。",
        "typical_foods": "清涼飲料、キャンディ、ゼリー、ドレッシング、スポーツドリンクなど。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "レモンなどにも含まれる有機酸で、酸味付けやpH調整に広く用いられる。通常の摂取量での安全性は高いと評価されている。",
        "detail_safety": "食品添加物としてのクエン酸は長年使用されており、通常量の摂取で健康への大きな懸念は少ないとされる。",
        "detail_effect": "爽やかな酸味を付けたり、他の風味を引き立てたり、pHを調整して保存性を助ける役割を持つ。",
        "detail_risks": "酸味の強い飲料を頻繁に少しずつ口に含む習慣は、歯のエナメル質への負担になる可能性がある。",
        "vulnerable_groups": "胃が弱い人は空腹時の酸味飲料を控えめにすると安心な場合がある。",
        "usage_guideline": "通常の食生活で大きな問題はないが、酸味飲料のダラダラ飲みは歯のケアと併せて注意したい。",
        "shopping_advice": "スポーツドリンクや酸味の強い飲料は、飲んだ後に水やお茶で口を流すと歯の負担を軽減しやすい。",
        "cooking_tips": "レモン汁の代わりに少量のクエン酸を使うことで、酸味を細かく調整できる。",
        "evidence_level": 3,
        "tags": ["pH調整剤", "酸味料", "有機酸"],
    },

    # クエン酸ナトリウム
    {
        "code": "E331",
        "name_ja": "クエン酸ナトリウム",
        "name_en": "Sodium Citrates",
        "category": "pH調整剤",
        "aliases": [
            "クエン酸三ナトリウム",
            "pH調整剤（クエン酸Na）",
        ],
        "label_names": [
            "pH調整剤（クエン酸Na）",
            "pH調整剤（クエン酸ナトリウム）",
        ],
        "function_detail": "クエン酸のナトリウム塩で、酸味の調整や緩衝能付与に用いられる。",
        "typical_foods": "清涼飲料、スポーツドリンク、加工チーズ、加工肉製品など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "クエン酸のナトリウム塩で、酸味をマイルドにしつつpHを整える目的で使用される。",
        "detail_safety": "通常の使用量では安全とされるが、ナトリウムを含むため塩分摂取量の一部にはなる。",
        "detail_effect": "pHを安定させ、金属イオンの影響を抑えたり、味を尖らせ過ぎないように整える。",
        "detail_risks": "塩分全体が気になる人は、加工食品の総量に注意しながら付き合うのが無難。",
        "vulnerable_groups": "高血圧や心疾患などで塩分制限中の人は、加工食品全体の塩分量に留意が必要。",
        "usage_guideline": "単体を過度に恐れるより、加工食品依存を避けるという視点が重要。",
        "shopping_advice": "『pH調整剤（クエン酸Na）』などと表示されることが多い。",
        "evidence_level": 3,
        "tags": ["pH調整剤", "有機酸塩", "ナトリウム"],
    },

    # 乳酸
    {
        "code": "E270",
        "name_ja": "乳酸",
        "name_en": "Lactic Acid",
        "category": "pH調整剤",
        "aliases": [
            "酸味料（乳酸）",
            "pH調整剤（乳酸）",
        ],
        "label_names": [
            "酸味料（乳酸）",
            "pH調整剤（乳酸）",
        ],
        "function_detail": "発酵などで生成される有機酸で、まろやかな酸味とpH調整の目的で使用される。",
        "typical_foods": "ヨーグルト、発酵乳飲料、漬物、ソーセージ、ソフトドリンクなど。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "発酵由来の有機酸で、まろやかな酸味付けやpH調整に使われる。通常の摂取量では安全性が高い添加物とされる。",
        "detail_safety": "発酵食品にも含まれる成分であり、一般的な使用量での健康リスクは低いと評価されている。",
        "detail_effect": "酸味を与えるだけでなく、発酵系の風味を補強し、保存性の向上にも寄与する。",
        "tags": ["pH調整剤", "酸味料", "有機酸", "発酵"],
    },

    # リン酸塩（pH調整剤として）
    {
        "code": "E339–E343",
        "name_ja": "リン酸塩（pH調整剤）",
        "name_en": "Phosphates (pH regulators)",
        "category": "pH調整剤",
        "aliases": [
            "リン酸ナトリウム",
            "リン酸水素ナトリウム",
            "リン酸カリウム",
            "pH調整剤（リン酸塩）",
        ],
        "label_names": [
            "pH調整剤（リン酸Na）",
            "pH調整剤（リン酸K）",
            "pH調整剤（リン酸塩）",
        ],
        "function_detail": "pH調整や保水性向上、乳化安定など多目的に使われる無機塩。",
        "typical_foods": "ハム・ソーセージなどの加工肉、チーズ、粉末飲料、インスタント食品など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "pH調整や保水性向上など多目的に使われるリン酸塩。通常量では安全とされる一方、加工食品に偏るとリンの摂り過ぎにつながる可能性がある。",
        "detail_safety": "使用基準内では安全とされるが、腎機能に問題がある場合や加工食品に偏った食生活ではリンやナトリウム過多が懸念される。",
        "detail_effect": "食感の改善や結着力の向上、色調や風味の安定化など多様な目的で利用される。",
        "detail_risks": "加工肉やインスタント食品の多用は、リン酸塩だけでなく塩分・脂質なども含めた過剰摂取につながりやすい。",
        "vulnerable_groups": "腎機能が低下している人、医師からリン制限を指示されている人。",
        "usage_guideline": "加工肉やインスタント食品を『毎日主役』にせず、あくまで時々楽しむ程度に抑えるのが無難。",
        "shopping_advice": "原材料欄の『pH調整剤（リン酸Na）』などを目安に、日常的に食べる頻度をコントロールするとよい。",
        "evidence_level": 3,
        "tags": ["pH調整剤", "リン酸塩", "加工肉"],
        "note_for_reply": "『たまに食べる分には問題ないが、常に加工肉ばかりだと負担が増える』というニュアンスが使いやすいです。",
    },

    # =========================================================
    # 香料
    # =========================================================

    # 総称：香料
    {
        "code": None,
        "name_ja": "香料",
        "name_en": "Flavourings (general)",
        "category": "香料",
        "aliases": [
            "合成香料",
            "天然香料",
            "香料（バニリン）",
            "香料（ミント）",
        ],
        "label_names": [
            "香料",
            "香料（○○）",
        ],
        "function_detail": "香りや風味を付けるために使われる添加物の総称。天然由来・合成由来の両方を含む。",
        "typical_foods": "清涼飲料、アイス、ヨーグルト、スナック菓子、菓子パン、ガムなど多くの加工食品。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "香りや風味をつけるために使われる総称。天然由来のものから合成香料まで含まれ、多くはごく少量が使用される。",
        "detail_safety": "食品添加物として使用される香料は個別に安全性評価を受けており、通常量では大きな健康リスクは少ないとされる。ただし、どの成分が使われているかラベルからは分かりにくい。",
        "detail_effect": "香りを補ったり、原材料のばらつきをカバーして『いつも同じ味・香り』を再現しやすくする。",
        "detail_risks": "香りの強い甘い飲料や菓子は食べ過ぎ・飲み過ぎのきっかけになりやすく、香料そのものより『摂りすぎ』の方が問題になりがち。",
        "vulnerable_groups": "香りに敏感な人や一部の化学物質に過敏な人では、頭痛・気分不良などのトリガーになることもある。",
        "usage_guideline": "香料そのものを過度に恐れるより、香りの強い甘い食品に偏らないバランスが大切。",
        "shopping_advice": "香りの強いお菓子や飲料ばかりになっていないか、ときどき全体の食生活を見直すのがおすすめ。",
        "cooking_tips": "家庭ではハーブやスパイス、柑橘の皮など自然な香り素材を使うと、添加物に頼らず香りのバリエーションを増やせる。",
        "evidence_level": 3,
        "tags": ["香料", "フレーバー"],
        "note_for_reply": "『香料そのものより、香りの強い甘い食品に偏りすぎないことが大事』というメッセージが使いやすいです。",
    },

    # 天然香料
    {
        "code": None,
        "name_ja": "天然香料",
        "name_en": "Natural flavourings",
        "category": "香料",
        "aliases": [
            "香料（レモン）",
            "香料（オレンジ）",
            "香料（ハーブ）",
        ],
        "label_names": [
            "香料（レモン）",
            "香料（オレンジ）",
            "香料（ハーブ）",
        ],
        "function_detail": "植物や動物由来の成分から抽出・精製した香り成分。",
        "typical_foods": "フルーツ風味飲料、ヨーグルト、アイス、ハーブ系飲料やお菓子など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "植物などから抽出した香り成分を使った香料。合成香料と比べてイメージは穏やかだが、アレルギー体質などでは注意が必要な場合もある。",
        "detail_safety": "一般的な使用量では安全とされるが、柑橘由来の成分などで皮膚刺激や光過敏性が報告されるものもある。",
        "detail_effect": "自然な香りのニュアンスを食品に付与し、風味を豊かにする。",
        "detail_risks": "アレルギー体質や香りに敏感な人では、特定の植物由来成分に反応するケースもある。",
        "vulnerable_groups": "柑橘アレルギー、ハーブアレルギーなど既往歴のある人。",
        "usage_guideline": "違和感を感じた製品は無理に続けず、別のブランドやフレーバーに切り替えるとよい。",
        "shopping_advice": "『香料（レモン）』など具体的な植物名が書いてあると、ある程度イメージしやすい。",
        "evidence_level": 3,
        "tags": ["香料", "天然香料"],
    },

    # 合成香料
    {
        "code": None,
        "name_ja": "合成香料",
        "name_en": "Artificial flavourings",
        "category": "香料",
        "aliases": [
            "人工香料",
            "香料（人工）",
        ],
        "label_names": [
            "香料",
        ],
        "function_detail": "化学的に合成した香り成分で、特定の香りを安定して再現するのに使われる。",
        "typical_foods": "キャンディ、ガム、清涼飲料、スナック菓子、デザートなど。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "化学的に合成された香り成分で、特定の香りを安定して再現するために使われる。通常量では安全とされるが、気になる人は摂取頻度を調整して付き合うと安心。",
        "detail_safety": "食品添加物として使用される合成香料は個別に安全性評価を受けており、使用基準内では安全とされている。",
        "detail_effect": "原材料に左右されず、安定した香りや風味を再現しやすくする。",
        "detail_risks": "香りの強い甘いお菓子や飲料の摂り過ぎにつながる点が実際のリスクになりやすい。",
        "vulnerable_groups": "化学物質過敏症など、特定の香り成分で体調を崩しやすい人。",
        "usage_guideline": "完全に避ける必要はないが、香りの強いお菓子・飲料ばかりに偏らないようにするのが現実的。",
        "shopping_advice": "『香料』とだけ書かれている場合、中身は天然・合成どちらも含み得る。気になる人はシンプルな原材料の商品を選ぶと安心感が高い。",
        "evidence_level": 3,
        "tags": ["香料", "合成香料"],
        "note_for_reply": "『香料そのものは基準内なら安全とされるが、甘いお菓子の摂り過ぎには注意』という二段構えの伝え方がしやすいです。",
    },

    # バニリン（バニラ香料の代表）
    {
        "code": "E1519",
        "name_ja": "バニリン",
        "name_en": "Vanillin",
        "category": "香料",
        "aliases": [
            "香料（バニラ）",
            "香料（バニリン）",
        ],
        "label_names": [
            "香料（バニラ）",
            "香料（バニリン）",
        ],
        "function_detail": "バニラ風味を付ける代表的な香料。天然由来のものと合成由来のものがある。",
        "typical_foods": "バニラアイス、プリン、ヨーグルト、焼き菓子、カスタード風味のお菓子など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "バニラ風味を付けるための代表的な香料。長年使われており、通常量では安全性が高いとされる。",
        "detail_safety": "多くの国で食品・香粧品などに利用されており、一般的な使用量では健康上の大きな懸念は少ないと評価されている。",
        "detail_effect": "甘さや乳製品のコクと相性が良く、デザート系の風味を引き立てる。",
        "detail_risks": "甘いデザート類の食べ過ぎがカロリー・糖質過多につながりやすい点に注意。",
        "usage_guideline": "デザート類を毎日大量に食べる習慣にならないよう、頻度や量を調整できると安心。",
        "tags": ["香料", "バニラ", "デザート"],
    },

    # ミント系香料（ペパーミントフレーバー）
    {
        "code": None,
        "name_ja": "香料（ミント系）",
        "name_en": "Mint flavourings",
        "category": "香料",
        "aliases": [
            "香料（ペパーミント）",
            "香料（スペアミント）",
        ],
        "label_names": [
            "香料（ミント）",
            "香料（ペパーミント）",
        ],
        "function_detail": "清涼感のあるミント系の香りを付けるための香料。天然・合成いずれの成分も含み得る。",
        "typical_foods": "ガム、タブレット菓子、チョコレート、清涼飲料、オーラルケア系製品など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "清涼感のあるミントの香り付けに使われる香料。通常量では安全とされるが、香りに敏感な人では刺激を強く感じることもある。",
        "detail_safety": "ペパーミント油などはハーブとしても利用されており、一般的な食品利用での安全性は高いとされる。ただし高濃度では刺激が強くなる。",
        "detail_effect": "口の中をすっきりさせる清涼感を与え、甘さの後味を引き締める。",
        "vulnerable_groups": "香りに敏感な人や胃酸過多の人では、強いミントが合わない場合がある。",
        "usage_guideline": "体質に合わないと感じた場合は、ミントの弱い製品や別フレーバーを選ぶとよい。",
        "tags": ["香料", "ミント", "清涼感"],
    },
# =========================================================
# 着色料（タール色素 / カロチノイド / 紅麹 / クチナシ）
# =========================================================

COLORING_ADDITIVES: List[Dict[str, Any]] = [

    # ---------------------------------
    # タール色素（合成着色料）
    # ---------------------------------

    # 赤色40号（Allura Red AC）
    {
        "code": "E129",
        "name_ja": "赤色40号",
        "name_en": "Allura Red AC",
        "category": "着色料",
        "aliases": [
            "赤40",
            "赤色102（海外表記との混同に注意）",
            "タール色素（赤色40号）",
        ],
        "label_names": [
            "着色料（赤40）",
            "着色料（赤色40号）",
        ],
        "function_detail": "飲料や菓子などを鮮やかな赤色に着色するための合成着色料。",
        "typical_foods": "清涼飲料、ゼリー、キャンディ、アイス、シロップなど。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "鮮やかな赤色を出すために使われる合成着色料。基準内使用で認可されているが、海外では子どもの行動への影響などが議論されることもあり、慎重に見たい色素のひとつ。",
        "detail_safety": "各国で使用基準が設けられ、基準内では使用が認められている。一方で、子どもの多動との関連やアレルギー様症状などの可能性が議論されているため、注意しておきたい色素とされることも多い。",
        "detail_effect": "食品を鮮やかな赤色に着色し、見た目のインパクトやおいしさの印象を高める目的で使われる。",
        "detail_risks": "色の濃い菓子や飲料を大量・頻回に摂ると、添加物全体の負担や糖質・カロリー過多にもつながりやすい。",
        "vulnerable_groups": "小さな子ども、アレルギー体質の人、化学物質に敏感な人などは摂取頻度を控えめにすると安心。",
        "usage_guideline": "たまに少量楽しむ程度なら大きな問題になりにくいが、日常的に多量に摂らないよう意識したい。",
        "shopping_advice": "原材料表示の『赤色40号』『赤40』『着色料（赤40）』が目印。毎日の定番おやつは、できれば色の穏やかなものも混ぜてバランスを取りたい。",
        "cooking_tips": "家庭ではイチゴやベリーのピューレ、トマトなど自然な赤色素材で色付けするのも選択肢。",
        "evidence_level": 3,
        "tags": ["着色料", "タール色素", "赤色"],
        "note_for_reply": "『たまの楽しみなら神経質になりすぎなくてOK。ただ、子どものお菓子が“派手色ばかり”にならないようにバランスを取りたい』というトーンがおすすめです。",
    },

    # 赤色102号（NEW Coccine）
    {
        "code": "E124",
        "name_ja": "赤色102号",
        "name_en": "Ponceau 4R / New Coccine",
        "category": "着色料",
        "aliases": [
            "赤102",
            "ニューコクシン",
            "タール色素（赤色102号）",
        ],
        "label_names": [
            "着色料（赤102）",
            "着色料（赤色102号）",
        ],
        "function_detail": "赤〜橙色系の鮮やかな色を付けるために使われる合成着色料。",
        "typical_foods": "清涼飲料、シロップ、製菓、漬物、魚肉ソーセージなど。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "鮮やかな赤〜橙色を出すタール系着色料。各国で使用量や使用食品が細かく規制されており、日本でも注意添加物として名前が挙がりやすい色素。",
        "detail_safety": "使用基準内であれば認可されているが、アレルギー様症状や子どもの行動への影響が議論された経緯があり、海外では使用規制が強い国もある。",
        "detail_effect": "加工食品の色を鮮やかに整え、見た目の魅力や“それらしい色合い”を再現する。",
        "detail_risks": "色付き加工食品を多く摂る生活は、添加物全体の負担や塩分・糖分過多ともセットになりやすい。",
        "vulnerable_groups": "アレルギー体質の人や、お子さんの食生活が気になる家庭など。",
        "usage_guideline": "毎日大量に摂るのは避け、イベントや特別な日のお楽しみ程度に使い分けるのが無難。",
        "shopping_advice": "『赤色102号』と書かれた製品が続く場合は、色の穏やかな商品を間に挟むなどしてバランスを取りたい。",
        "evidence_level": 3,
        "tags": ["着色料", "タール色素", "赤色"],
    },

    # 黄色4号（タートラジン）
    {
        "code": "E102",
        "name_ja": "黄色4号",
        "name_en": "Tartrazine",
        "category": "着色料",
        "aliases": [
            "黄4",
            "タートラジン",
            "タール色素（黄色4号）",
        ],
        "label_names": [
            "着色料（黄4）",
            "着色料（黄色4号）",
        ],
        "function_detail": "レモンイエローのような明るい黄色をつける合成着色料。",
        "typical_foods": "清涼飲料、キャンディ、ゼリー、スナック菓子、漬物など。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "明るい黄色を出す代表的なタール色素。アレルギー様症状との関連が報告されることがあり、慎重に見られることの多い色素。",
        "detail_safety": "使用基準内で認可されている一方、ぜんそくやアレルギー体質の人で症状悪化が疑われた報告もあり、海外では注意喚起表示が求められるケースもある。",
        "detail_effect": "飲料や菓子をレモンイエローに着色し、さわやかなイメージやフレーバーを視覚的に補強する。",
        "detail_risks": "黄色のお菓子や飲料を大量に摂ると、添加物単体だけでなく糖質や酸味などの負担も増える。",
        "vulnerable_groups": "アレルギー体質、ぜんそくの既往がある人、小さな子どもなど。",
        "usage_guideline": "特に体質的な不安がある場合は、黄色4号を多く含む製品を毎日続けて摂らないよう意識すると安心。",
        "shopping_advice": "『黄色4号』『黄4』と記載されているかをチェックし、気になる人は回数を減らしたり別商品を選ぶのも一案。",
        "evidence_level": 3,
        "tags": ["着色料", "タール色素", "黄色"],
    },

    # 黄色5号（サンセットイエロー）
    {
        "code": "E110",
        "name_ja": "黄色5号",
        "name_en": "Sunset Yellow FCF",
        "category": "着色料",
        "aliases": [
            "黄5",
            "サンセットイエロー",
            "タール色素（黄色5号）",
        ],
        "label_names": [
            "着色料（黄5）",
            "着色料（黄色5号）",
        ],
        "function_detail": "オレンジ〜黄色系の明るい色を付けるための合成着色料。",
        "typical_foods": "清涼飲料、ゼリー、アイス、スナック菓子、漬物など。",
        "risk_level": 3,
        "risk_label": "注意",
        "simple_summary": "オレンジがかった黄色を出すタール色素。海外での注意喚起表示などもあり、気にする人も多い着色料のひとつ。",
        "detail_safety": "使用基準内であれば認可されているが、アレルギー様症状や行動への影響が示唆された報告もあり、一部の国では注意書きが義務付けられている。",
        "detail_effect": "オレンジジュース風・マンゴー風などのイメージを視覚的に補強する。",
        "detail_risks": "タール色素を含む飲料やお菓子に偏ると、糖質・酸味・添加物がトータルで多くなりやすい。",
        "vulnerable_groups": "小児、アレルギー体質、ぜんそく傾向のある人など。",
        "usage_guideline": "日常的に大量に摂らず、『イベントやたまのお楽しみ』にとどめる意識が安心。",
        "shopping_advice": "パッケージ裏で『黄色5号』『黄5』の表示を確認しつつ、色の穏やかな製品も組み合わせて選ぶとよい。",
        "evidence_level": 3,
        "tags": ["着色料", "タール色素", "黄色"],
    },

    # 青色1号（ブリリアントブルー）
    {
        "code": "E133",
        "name_ja": "青色1号",
        "name_en": "Brilliant Blue FCF",
        "category": "着色料",
        "aliases": [
            "青1",
            "ブリリアントブルー",
            "タール色素（青色1号）",
        ],
        "label_names": [
            "着色料（青1）",
            "着色料（青色1号）",
        ],
        "function_detail": "鮮やかな青色を付ける合成着色料。",
        "typical_foods": "ラムネ飲料、かき氷シロップ、ゼリー、キャンディなど。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "鮮やかな青色を出すタール色素。基準内使用で認可されているが、いかにも人工的な色合いの代表格であり、摂取量・頻度を意識したい色素。",
        "detail_safety": "一般的な使用量では安全と評価されているが、タール色素全体への懸念から、なるべく控えたいと考える人も多い。",
        "detail_effect": "青い飲み物やかき氷など、視覚的インパクトの強い色を演出する。",
        "detail_risks": "派手な色のお菓子・飲料を好むと、糖質や他の添加物も含めた『全体量』が増えがち。",
        "vulnerable_groups": "小さな子どもや、添加物をなるべく減らしたいと考えている人など。",
        "usage_guideline": "夏祭りのかき氷など『イベント的に楽しむ』使い方なら、過度に恐れすぎる必要はない。",
        "shopping_advice": "日常使いのおやつは、毎回ブルー系ではなく、色の穏やかなものとローテーションするのがおすすめ。",
        "evidence_level": 3,
        "tags": ["着色料", "タール色素", "青色"],
    },

    # ---------------------------------
    # カロチノイド系・その他天然系色素
    # ---------------------------------

    # カロチノイド色素（総称）
    {
        "code": "E160",
        "name_ja": "カロチノイド色素",
        "name_en": "Carotenoid colourings",
        "category": "着色料",
        "aliases": [
            "カロチノイド",
            "カロテノイド色素",
            "着色料（カロチノイド）",
        ],
        "label_names": [
            "着色料（カロチノイド）",
            "着色料（カロテノイド）",
        ],
        "function_detail": "植物などに含まれるカロチノイド由来の黄色〜橙色系の天然系色素の総称。",
        "typical_foods": "マーガリン、チーズ、菓子パン、飲料、スナック菓子など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "植物由来の黄色〜橙色の色素。通常の食品利用では安全性が高いとされるが、サプリメントなどでの極端な高用量摂取は別途議論がある。",
        "detail_safety": "食品中で使われる量では安全と評価されている。一方、特定のカロチノイドをサプリメントで大量摂取した場合の影響については研究結果が分かれる。",
        "detail_effect": "バターや卵黄のような黄色〜橙色を補い、見た目のコクや自然さを演出する。",
        "detail_risks": "通常の食品量では問題は少ないが、サプリなどで偏って大量摂取しないことが大切。",
        "usage_guideline": "加工食品から摂る分には過度な心配は不要だが、サプリ利用時は用量や目的をよく確認する。",
        "tags": ["着色料", "カロチノイド", "天然系"],
    },

    # β-カロテン
    {
        "code": "E160a",
        "name_ja": "β-カロテン",
        "name_en": "Beta-carotene",
        "category": "着色料",
        "aliases": [
            "プロビタミンA",
            "着色料（β-カロテン）",
        ],
        "label_names": [
            "着色料（カロチノイド）",
            "着色料（β-カロテン）",
        ],
        "function_detail": "ニンジンなどに含まれるカロチノイドの一種で、黄色〜橙色の着色に利用される。",
        "typical_foods": "マーガリン、チーズ、菓子パン、清涼飲料、スナック菓子など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "ニンジンなどに含まれる色素成分。通常の食品利用では安全性が高いとされる。",
        "detail_safety": "食品中での使用量は安全と評価されているが、喫煙者がサプリメントとして大量摂取した場合のリスクが指摘された研究もあり、サプリでの過剰摂取は避けたい。",
        "detail_effect": "黄色〜橙色を付けるとともに、コクのある色合いでおいしそうな見た目を演出する。",
        "detail_risks": "食品からの摂取では大きな問題になりにくいが、サプリメントなどでの大量摂取は避ける。",
        "usage_guideline": "普通の食事の範囲であれば、あまり神経質になる必要はない。",
        "tags": ["着色料", "カロチノイド", "βカロテン"],
    },

    # パプリカ色素
    {
        "code": "E160c",
        "name_ja": "パプリカ色素",
        "name_en": "Paprika extract",
        "category": "着色料",
        "aliases": [
            "パプリカ抽出色素",
            "着色料（パプリカ色素）",
        ],
        "label_names": [
            "着色料（パプリカ色素）",
        ],
        "function_detail": "パプリカから得られるカロチノイド系色素で、赤〜橙色系の自然な色合いを付ける。",
        "typical_foods": "スナック菓子、ソーセージ、ドレッシング、スープ、チーズ製品など。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "パプリカ由来の天然系色素。自然な赤〜橙色を付ける目的で使われ、通常量では安全性が高いとされる。",
        "detail_safety": "香辛料由来の成分として長く利用されており、一般的な使用量での健康リスクは低いと評価されている。",
        "detail_effect": "自然な色合いで見た目を整えつつ、スパイス感やコクのイメージを補う。",
        "vulnerable_groups": "パプリカやトウガラシ類にアレルギーがある人は注意。",
        "tags": ["着色料", "カロチノイド", "天然系", "パプリカ"],
    },

    # 紅麹色素
    {
        "code": None,
        "name_ja": "紅麹色素",
        "name_en": "Red yeast rice colour",
        "category": "着色料",
        "aliases": [
            "ベニコウジ色素",
            "着色料（紅麹）",
        ],
        "label_names": [
            "着色料（紅麹）",
            "着色料（ベニコウジ色素）",
        ],
        "function_detail": "紅麹菌で米などを発酵させたときに得られる赤色系天然色素。",
        "typical_foods": "かまぼこ、ソーセージ、漬物、菓子、和菓子類など。",
        "risk_level": 2,
        "risk_label": "やや注意",
        "simple_summary": "麹由来の赤色系天然色素。通常の食品利用では広く使われているが、製品や製造条件によって成分の違いがあるため、近年は品質管理が重視されている。",
        "detail_safety": "食品添加物としての紅麹色素は基準に沿って管理されているが、サプリメント用途などでの別製品に関して安全性が問題となった例もあり、由来や用途によって評価が分かれる部分がある。",
        "detail_effect": "かまぼこや漬物などに自然な赤みを付け、見た目を華やかにする。",
        "detail_risks": "一般的な食品利用では大きな問題になりにくいが、サプリや健康食品として高濃度の紅麹成分を摂取する場合は、メーカー情報や公的な注意喚起をよく確認したい。",
        "usage_guideline": "日常的な加工食品からの摂取は過度に心配しすぎる必要はないが、健康食品・サプリで紅麹をとる場合は情報収集が重要。",
        "shopping_advice": "『着色料（紅麹）』と書かれている一般食品は、摂り過ぎにならない範囲で普通に付き合うイメージでよい。",
        "evidence_level": 2,
        "tags": ["着色料", "天然系", "紅麹"],
        "note_for_reply": "最近のニュースを気にされている方には、『一般的な食品の紅麹色素と、サプリなどで問題になった紅麹製品は別物として扱われることが多い』と丁寧に説明すると親切です。",
    },

    # クチナシ色素
    {
        "code": None,
        "name_ja": "クチナシ色素",
        "name_en": "Gardenia yellow/blue colour",
        "category": "着色料",
        "aliases": [
            "クチナシ黄色素",
            "クチナシ青色素",
            "着色料（クチナシ）",
        ],
        "label_names": [
            "着色料（クチナシ）",
            "着色料（クチナシ黄色素）",
            "着色料（クチナシ青色素）",
        ],
        "function_detail": "クチナシの実などから得られる天然系色素で、黄〜緑〜青系の色付けに使われる。",
        "typical_foods": "たくあん、和菓子、スイーツ、飲料、アイスなど。",
        "risk_level": 1,
        "risk_label": "低め",
        "simple_summary": "クチナシ由来の天然系色素。黄色や青色などを比較的穏やかなトーンで付ける目的で使われる。",
        "detail_safety": "長年利用されている天然系色素で、通常の使用量では大きな健康リスクは少ないとされる。",
        "detail_effect": "たくあんの黄色や、和菓子・スイーツの色合いなど、自然寄りの色調を表現する。",
        "vulnerable_groups": "ごくまれに植物由来成分に敏感な人もいるため、違和感が続く場合は医療機関に相談を検討。",
        "usage_guideline": "一般的な食品からの摂取で、特に強い制限を意識する必要は少ない。",
        "shopping_advice": "『着色料（クチナシ）』と表示されている場合、いわゆる合成タール系とは性格の違う天然系色素と理解してよい。",
        "evidence_level": 3,
        "tags": ["着色料", "天然系", "クチナシ"],
    },
]
# ==========
# メイン処理
# ==========

# ALL_ADDITIVES と COLORING_ADDITIVES を結合してから upsert する
def main() -> None:
    all_rows = ALL_ADDITIVES + COLORING_ADDITIVES

    rows = [prepare_additive_row(a) for a in all_rows]

    chunk_size = 50
    for i in range(0, len(rows), chunk_size):
        batch = rows[i : i + chunk_size]
        print(f"Upserting {len(batch)} rows... ({i+1} - {i+len(batch)})")

        supabase.table("additives_dict").upsert(
            batch,
            on_conflict="name_ja"
        ).execute()

    print("✅ additives_dict master sync completed.")


if __name__ == "__main__":
    main()

